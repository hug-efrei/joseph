<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joseph Library</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Georgia', serif; margin: 0; padding: 0; 
            background: #ffffff; color: #000000; 
        }

        header { 
            border-bottom: 3px solid #000; padding: 15px; display: flex; gap: 10px; background: #fff;
            position: sticky; top: 0; z-index: 100;
        }
        input[type="text"] { 
            flex-grow: 1; padding: 10px; font-size: 1.3rem; border: 2px solid #000; border-radius: 0;
        }
        button.search-btn { 
            background: #000; color: #fff; border: none; padding: 0 20px; font-size: 1.3rem; font-weight: bold;
        }
        
        /* Bouton Reset pour annuler les filtres */
        .btn-reset {
            display: inline-flex; align-items: center; padding: 0 15px;
            text-decoration: none; color: #000; font-weight: bold; border: 2px solid #000;
        }

        .grid { 
            display: flex; flex-wrap: wrap; justify-content: space-between; padding: 10px; max-width: 100%;
        }

        .book-card { 
            width: 49%; margin-bottom: 20px; 
            display: flex; flex-direction: row;
            border: 2px solid #000; background: #fff; padding: 10px; overflow: hidden;
        }

        .cover-col {
            width: 40%; flex-shrink: 0; padding-right: 10px;
            display: flex; align-items: flex-start; justify-content: center;
        }
        
        .cover { 
            width: 100%; height: auto; object-fit: contain;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2); border: 1px solid #333;
        }

        .info-col {
            width: 60%; display: flex; flex-direction: column; justify-content: space-between; text-align: left;
        }

        .title { 
            font-weight: bold; font-size: 1.1rem; line-height: 1.3; margin-bottom: 5px; color: #000;
        }
        
        .series {
            font-size: 0.9rem; font-weight: bold; color: #555; margin-bottom: 4px;
        }

        .author { 
            font-size: 1rem; font-style: italic; color: #444; margin-bottom: 10px;
        }

        /* Liens clicables améliorés */
        a.filter-link { text-decoration: underline; color: inherit; cursor: pointer; }
        a.text-link { text-decoration: none; color: inherit; }

        .btn-dl {
            display: block; width: 100%; background: #fff; color: #000; border: 2px solid #000;
            padding: 12px 0; text-align: center; text-decoration: none; 
            font-weight: bold; font-size: 1rem; text-transform: uppercase; margin-top: auto;
        }
        .btn-dl:active { background: #000; color: #fff; }

        .pagination {
            display: flex; justify-content: space-between; align-items: center;
            padding: 30px 15px; background: #eee; border-top: 2px solid #000;
        }
        .nav-link {
            text-decoration: none; color: #000; font-weight: bold; font-size: 1.3rem;
            padding: 15px 30px; border: 2px solid #000; background: #fff;
        }
        .nav-link.disabled { opacity: 0.3; border-color: #aaa; background: #eee; pointer-events: none; }

        @media (max-width: 600px) {
            .book-card { width: 100%; margin-bottom: 15px; }
            .pagination { padding: 15px 10px; }
            .nav-link { font-size: 1rem; padding: 10px 15px; }
            .cover-col { width: 35%; } .info-col { width: 65%; }
        }
    </style>
</head>
<body>

<header>
    {{ if or .AuthorID .SeriesID .Query }}
        <a href="/" class="btn-reset">X</a>
    {{ end }}
    <form action="/" method="GET" style="display:flex; width:100%; gap:10px;">
        <input type="text" name="q" placeholder="Rechercher..." value="{{ .Query }}">
        <button type="submit" class="search-btn">GO</button>
    </form>
</header>

<div class="grid">
    {{ if not .Books }}
        <p style="width:100%; text-align:center; font-size:1.2rem; margin-top:40px;">Aucun livre trouvé.</p>
    {{ end }}

    {{ range .Books }}
    <div class="book-card">
        <div class="cover-col">
            <a href="/book/{{.ID}}">
                <img src="/cover/{{.ID}}?path={{.Path}}" class="cover" alt="cover" loading="lazy">
            </a>
        </div>
        
        <div class="info-col">
            <div>
                <a href="/book/{{.ID}}" class="text-link">
                    <div class="title">{{ .Title }}</div>
                </a>
                
                {{ if .Series }}
                <div class="series">
                    <a href="/?series_id={{.SeriesID}}" class="filter-link">{{ .Series }}</a> 
                    - T{{ .SeriesIndex }}
                </div>
                {{ end }}

                <div class="author">
                    <a href="/?author_id={{.AuthorID}}" class="filter-link">{{ .Author }}</a>
                </div>
            </div>
            <a href="/download/{{.ID}}?path={{.Path}}" class="btn-dl">Télécharger</a>
        </div>
    </div>
    {{ end }}
</div>

<div class="pagination">
    {{ if gt .Page 1 }}
        <a href="/?q={{.Query}}&page={{.PrevPage}}&author_id={{.AuthorID}}&series_id={{.SeriesID}}" class="nav-link">← Préc.</a>
    {{ else }}
        <span class="nav-link disabled">← Préc.</span>
    {{ end }}

    <span style="font-size: 1.2rem; font-weight:bold;">Page {{ .Page }}</span>

    {{ if .HasNext }}
        <a href="/?q={{.Query}}&page={{.NextPage}}&author_id={{.AuthorID}}&series_id={{.SeriesID}}" class="nav-link">Suiv. →</a>
    {{ else }}
        <span class="nav-link disabled">Suiv. →</span>
    {{ end }}
</div>

</body>
</html>